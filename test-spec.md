# テスト仕様書: Flask + OpenRouter AI チャットアプリ

## 1. テスト対象: AIディベートアプリ
- `app.py`（Flaskサーバー/APIバックエンド）
- `static/index.html`（フロントエンドUI）

## 2. テスト環境
- Windows 10/11
- Python 3.8以降
- Flask, openai, python-dotenv
- OpenRouter APIキー設定済み
- ブラウザ: Chrome, Edge, Firefox

## 3. テスト項目

### 3.1. サーバー起動・静的ファイル配信
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 1  | サーバー起動 | `python app.py`で起動 | エラーなく起動し、`http://localhost:5000/`でアクセス可能。 |
| 2  | UI初期表示 | ブラウザで`/`にアクセス | 「ディベートの設定」画面が表示される。 |
| 3  | APIキー未設定 | `.env`の`OPENROUTER_API_KEY`を空にして起動し、APIを呼び出す操作（テーマチェックなど）を行う。 | UIに「OpenRouter API key is not configured on the server.」というエラーが表示される。サーバーログに警告が出る。 |

### 3.2. ディベート設定画面 (`/validate_theme` API)
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 4  | テーマチェック（正常系） | 1. ディベートテーマ適切なテーマを入力。<br>2.「テーマをチェック」ボタンを押す。 | 1. ローディング表示が出る。<br>2. AIから「判定: 適切」と結果が返され、画面に表示される。<br>3. 「あなたの立場」「先攻/後攻」の選択肢と「ディベート開始」ボタンが表示される。 |
| 5  | テーマチェック（不適切） | 1. ディベートテーマに不適切なテーマを入力。<br>2. 「テーマをチェック」ボタンを押す。 | 1. ローディング表示が出る。<br>2. AIから「判定: 不適切」と理由が返され、画面に表示される。<br>3. 「ディベート開始」ボタンは表示されない。 |
| 6  | テーマチェック（空入力） | 1. ディベートテーマを空のまま「テーマをチェック」ボタンを押す。 | ボタンは非活性で押せない。 |
| 7  | ディベート開始（ユーザー先攻） | 1. テーマチェック後、「肯定・否定」「先攻」を選択。<br>2. 「ディベート開始」ボタンを押す。 | 1. チャット画面に遷移する。<br>2. 初期メッセージとして「...あなたの意見をどうぞ。」が表示される。<br>3. ユーザーがメッセージを入力できる状態になる。 |
| 8  | ディベート開始（AI先攻） | 1. テーマチェック後、「肯定・否定」「後攻」を選択。<br>2. 「ディベート開始」ボタンを押す。 | 1. チャット画面に遷移する。<br>2. 初期メッセージとして「...AIが最初の意見を述べます。」が表示され、ローディングが始まる。<br>3. AIの最初の意見が自動的に投稿される。 |
| 9  | ディベート開始ボタン非活性 | 1. テーマチェック後、「あなたの立場」または「先攻/後攻」のいずれかを選択しない。 | 「ディベート開始」ボタンは非活性で押せない。 |

### 3.3. チャット画面 (`/send_api` API)
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 10 | メッセージ送信（正常系） | 1. チャット画面でテキストを入力し「送信」ボタンを押す。<br>2. またはEnterキーを押す。 | 1. 自分のメッセージがチャット画面に表示される。<br>2. ローディングが表示される。<br>3. AIからの返信（反論）がチャット画面に表示される。 |
| 11 | メッセージ送信（空入力） | 1. テキストエリアが空の状態で「送信」ボタンを押す。 | ボタンは非活性で押せない。送信されない。 |
| 12 | 連続送信防止 | 1. AIが応答を生成中に「送信」ボタンを押す。 | ボタンは非活性で押せない。送信されない。 |
| 13 | リセット機能 | 1. チャット画面右上の「リセット」ボタンを押す。<br>2. 確認ダイアログで「OK」を押す。 | 1. ディベート設定画面に戻る。<br>2. 全ての入力と会話履歴がクリアされている。 |

### 3.4. API異常系
| No | テスト内容 | 手順 | 期待結果 |
|----|------------|------|----------|
| 14 | `/validate_theme` APIエラー | AIサービスとの通信に失敗した場合。 | UIに「テーマの妥当性チェック中にAIサービスでエラーが発生しました。」等のエラーメッセージが表示される。 |
| 15 | `/send_api` APIエラー | AIサービスとの通信に失敗した場合。 | チャット画面に「エラーが発生しました: ...」というメッセージが表示される。 |
| 16 | AIがJSON形式で返さない | `/validate_theme`でAIがJSON形式の応答を返さなかった場合。 | UIにエラーメッセージが表示されるか、処理が停止する。（具体的な挙動を確認） |

## 4. その他
- 入力最大長、応答最大長の確認
- 日本語以外の入力対応
- レスポンス速度の目安計測
- プロンプトの確認**: AIへのシステムプロンプトが意図通り（役割、立場、文字数制限など）に機能しているか、AIの応答内容から確認する。
- レスポンス速度**: 各API呼び出し（テーマチェック、メッセージ送信）のおおよその応答時間を計測する。
- クロスブラウザテスト**: Chrome, Edge, Firefoxで主要な機能が同様に動作することを確認する。

---
